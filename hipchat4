#! /bin/sh

set -e

mkdir -p  /home/`id -nu`/.hipchat4-docker

# Some magic to run hipchat maximized
if [ -r /home/`id -nu`/.hipchat4-docker/.config/Atlassian/HipChat.ini ] ; then
	sed -i -e 's/^windowMaximized=false$/windowMaximized=true/' \
		/home/`id -nu`/.hipchat4-docker/.config/Atlassian/HipChat.ini
fi

docker run -ti --rm \
	--device /dev/dri --device /dev/snd \
	-e DISPLAY=${DISPLAY} -e QT_AUTO_SCREEN_SCALE_FACTOR=1 \
	-v /home/`id -nu`/.hipchat4-docker:/home/`id -nu` \
	-v /var/run/dbus:/var/run/dbus \
	-v /tmp/.X11-unix:/tmp/.X11-unix \
	anight/hipchat4
